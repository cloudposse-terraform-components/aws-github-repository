# Define the environment configurations as anchors
nonprod_environment_defaults: &nonprod_environment_defaults
  secrets:
    argo_cd_deploy_nonprod_app_private_key: ""

prod_environment_defaults: &prod_environment_defaults
  secrets:
    argo_cd_deploy_prod_app_private_key: ""

components:
  terraform:
    github/app/argocd:
      metadata:
        type: abstract
      vars:
        variables:
          argo_cd_deploy_nonprod_app_id: 123456
          argo_cd_deploy_prod_app_id: 789012

        environments:
          preview:
            <<: *nonprod_environment_defaults
          dev:
            <<: *nonprod_environment_defaults
          staging:
            <<: *prod_environment_defaults
          prod:
            <<: *prod_environment_defaults

        rulesets:
          branch_protection:
            bypass_actors:
              # The github provider doesn't support the data resource for integrations, so we need to use the app ID.
              - actor_id: 123456 # "argo-cd-deploy-non-prod"
                actor_type: "Integration"
                bypass_mode: "always"
              - actor_id: 789012 # "argo-cd-deploy-prod"
                actor_type: "Integration"
                bypass_mode: "always"
