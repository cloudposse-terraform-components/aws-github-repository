components:
  terraform:
    github/ruleset/branch-protection:
      metadata:
        component: github-repository
        type: abstract
      vars:
        rulesets:
          branch_protection:
            name: "Branch Protection"
            enforcement: "active"
            target: "branch"
            rules:
              deletion: true
              non_fast_forward: true
              code_scanning:
                code_scanning_tools:
                  - tool: "CodeQL"
                    security_alerts_threshold: "high_or_higher"
                    alerts_threshold: "errors"
              pull_request:
                required_approving_review_count: 1
                dismiss_stale_reviews_on_push: true
                require_code_owner_review: true
                require_last_push_approval: false
                required_review_thread_resolution: true
                automatic_copilot_code_review_enabled: false
                allowed_merge_methods:
                  - "merge"
                  - "squash"
                  - "rebase"
            conditions:
              ref_name:
                include:
                  - "~DEFAULT_BRANCH"
                  - "refs/heads/main"
                  - "refs/heads/master"
                  - "refs/heads/dev"
                  - "refs/heads/staging"
                  - "refs/heads/prod"
                exclude: []
            bypass_actors:
              - actor_id: "devops" # use the team ID, not the team name. You can find this in the URL of the team page.
                actor_type: "Team"
                bypass_mode: "always"
